# Vim 的启动插件相关的加载

## 尝试查看

```
" 查看选项 runtimepath 的值
set runtimepath " 如果是非布尔值的选项，且不设置值；会打印出该选项的值

" 加载目录
1. ~/.vim
2. /var/lib/vim/addons
3. /etc/vim
4. /usr/share/vim/vimfiles
5. /usr/share/vim/vim81
6. /usr/share/vim/vimfiles/after
7. /etc/vim/after
8. /var/lib/vim/addons/after
9. ~/.vim/after

" 查看加载的文件
scriptnames

" 加载文件  
1: /usr/share/vim/vimrc
2: /usr/share/vim/vim81/debian.vim
3: /usr/share/vim/vim81/syntax/syntax.vim
4: /usr/share/vim/vim81/syntax/synload.vim
5: /usr/share/vim/vim81/syntax/syncolor.vim
6: /usr/share/vim/vim81/filetype.vim
7: ~/.vimrc
8: /usr/share/vim/vim81/ftplugin.vim
9: /usr/share/vim/vim81/indent.vim
10: /usr/share/vim/vim81/plugin/getscriptPlugin.vim
11: /usr/share/vim/vim81/plugin/gzip.vim
12: /usr/share/vim/vim81/plugin/logiPat.vim
13: /usr/share/vim/vim81/plugin/manpager.vim
14: /usr/share/vim/vim81/plugin/matchparen.vim
15: /usr/share/vim/vim81/plugin/netrwPlugin.vim
16: /usr/share/vim/vim81/plugin/rrhelper.vim
17: /usr/share/vim/vim81/plugin/spellfile.vim
18: /usr/share/vim/vim81/plugin/tarPlugin.vim
19: /usr/share/vim/vim81/plugin/tohtml.vim
20: /usr/share/vim/vim81/plugin/vimballPlugin.vim
21: /usr/share/vim/vim81/plugin/zipPlugin.vim

" 打开 cpp 文件
  1: /usr/share/vim/vimrc
  2: /usr/share/vim/vim81/debian.vim
  3: /usr/share/vim/vim81/syntax/syntax.vim
  4: /usr/share/vim/vim81/syntax/synload.vim
  5: /usr/share/vim/vim81/syntax/syncolor.vim
  6: /usr/share/vim/vim81/filetype.vim
  7: ~/.vimrc
  8: /usr/share/vim/vim81/ftplugin.vim
  9: /usr/share/vim/vim81/indent.vim
 10: /usr/share/vim/vim81/plugin/getscriptPlugin.vim
 11: /usr/share/vim/vim81/plugin/gzip.vim
 12: /usr/share/vim/vim81/plugin/logiPat.vim
 13: /usr/share/vim/vim81/plugin/manpager.vim
 14: /usr/share/vim/vim81/plugin/matchparen.vim
 15: /usr/share/vim/vim81/plugin/netrwPlugin.vim
 16: /usr/share/vim/vim81/plugin/rrhelper.vim
 17: /usr/share/vim/vim81/plugin/spellfile.vim
 18: /usr/share/vim/vim81/plugin/tarPlugin.vim
 19: /usr/share/vim/vim81/plugin/tohtml.vim
 20: /usr/share/vim/vim81/plugin/vimballPlugin.vim
 21: /usr/share/vim/vim81/plugin/zipPlugin.vim
 22: /usr/share/vim/vim81/syntax/cpp.vim
 23: /usr/share/vim/vim81/syntax/c.vim
 24: ~/.vim/ftplugin/cpp.vim
 25: /usr/share/vim/vim81/ftplugin/cpp.vim
 26: ~/.vim/ftplugin/c.vim
 27: /usr/share/vim/vim81/ftplugin/c.vim
 28: /usr/share/vim/vim81/indent/cpp.vim
```

## 文档：初始化步骤

[[https://yianwillis.github.io/vimcdoc/doc/starting.html#starting.txt]]

1. 设置环境变量，如：
```
VIM: /usr/share/vim
HOME: ~
...
```

2. 处理参数，如：
```
-V：显示细节
...
```

3. 根据环境变量，加载 `vimscript`

步骤：
1. 以 `evim` 启动，或带上 `-y` 参数，将载入 `$VIMRUNTIME/evim.vim` 脚本(似乎是一个 `ui`，且一直是插入模式)
2. 读入系统的 `vimrc` 进行初始化，路径：`$VIM/vimrc`
3. 其他初始化(每一项，只要找到了一个就进行下一项)
	1. `$VIMINIT` 的路径，一般为空
	2. 用户的配置文件
	3. `$EXINIT` 的路径
	4. 用户的 `exrc` 文件
	5. 如果没有 `vimrc` 文件，就用 `default.vim` 作为默认的配置文件
4. 如果打开了 `exrc` 选项，在当前目录搜索三个文件，先找到的使用，后面的舍弃
5. 载入插件脚本：`runtimepath` 下非 `after` 结尾目录都会搜索 `plugin` 目录，然后执行所有的 `.vim` 文件(按字母顺序)；待所有的都加载完，再搜索 `after` 结尾的目录进行执行
6. 其他初始化

## 文件探测相关

具体逻辑，怀疑是初始化的文件中设定的

```
filetype on
filetype plugin on
filetype indent on
```

1. 初始化时加载默认的文本高亮和缩进
2. 当探测到文件时：当进入一个 cpp 文件时，c 文件也会被探测到；且先加载 cpp 再加载 c
	1. 加载自带的高亮
	2. 加载自定义的插件(可以设置缩进操作)
	3. 加载自带的插件
	4. 开启缩进

# 缩进逻辑

## 四种缩进方式

1. `indentexpr`：根据表达式计算缩进
2. `cindent`：设置不同的缩进风格
3. `smartindent`：可以识别一些 c 语法，从而在不同地方增加/减少缩进
4. `autoindent`：沿用上一行的缩进

优先级依次从上到下

## 控制 c 语言的缩进

1. `cindent`
2. `cinkeys`
3. `cinoptions`
4. `cinwords`
5. `cinscopedecls`

### `cinkeys`

重新计算当前行缩进

"0{"               如果在该行输入的第一个字符是 '{' 
"0}"               如果在该行输入的第一个字符是 '}' 
"0)"               如果在该行输入的第一个字符是 ')' 
"0]"               如果在该行输入的第一个字符是 ']' 
":"                 如果在标号或是 case 语句后输入 ':' 
"0#"             如果在该行输入的第一个字符是 '#' 
"!^F"             如果输入 `CTRL-F` (它不会被插入) 
"o"                如果输入 `<CR>` 或是使用 "o" 命令 
"O"               如果使用 "O" 命令 
"e"                如果输入处于行首的 "else" 的第二个 'e'

### `cinwords`

当遇到这里定义的字时，为下一行增加缩进

### `cinoptions`

如何进行缩进

N：             缩进 N 格(右)
-N：           缩进 N 格(左)
Ns：           缩进 N 个 shiftwidth(右)
-Ns：         缩进 N 个 shiftwidth(左)