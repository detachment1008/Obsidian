# 引言
---

我们可以使用 Ex 命令，即命令行模式，它是针对行的命令
- 之前的 ex 行编辑器的命令

# 技巧 27 结识 Vim 的命令行模式
---

按下 : 进入命令行模式，再按下 \<CR> 执行它：
- / 和 \<C-r>= 这两个命令也会打开命令行模式

它可以：
- 读写文件
- 创建新标签页
- 分割窗口
- 操作参数列表
- 操作缓冲区列表

编辑文件的 Ex 命令：

|命令|用途|
| --- | --- |
|:\[range]delete \[x]|删除指定范围内的行(到寄存器 x 中)|
|:\[range]yank \[x]|复制指定范围内的行(到寄存器 x 中)|
|:\[line]put \[x]|在指定行后粘贴寄存器 x 中的内容|
|:\[range]copy {address}|把指定范围内的行拷贝到 {address} 所指定的行之下|
|:\[range]move {address}|把指定范围内的行移动到 {address} 所指定的行之下|
|:\[range]joint|连接指定范围内的行|
|:\[range]normal {commands}|对指定范围内的每一行执行普通模式命令{commands}|
|:\[range]substitute/{pattern}/{string}/\[flags]|把指定范围内出现{pattern}的地方替换为{string}|
|:\[range]global/{pattern}/\[cmd]|对指定范围内匹配{pattern}的所有行，执行 Ex 命令 {cmd}|

Vim 命令行模式中的特殊按键：这些和插入模式一样
- \<C-w>：删除至上个单词开头
- \<C-u>：删除至行首
- \<C-v>：插入键盘上没有的字符
- \<C-r>{register}：使用任意寄存器的值

# 技巧 28 在一行或多个连续行上执行命令
---

用行号作为地址：
- 只有行号：跳转
- $ ：文件末尾
- . ：当前位置
- %：文件中的所有行
- \`m：m 标记的行

用地址指定一个范围：
- {start},{end}

用高亮选区指定范围：
- 在可视模式选中后，进入命令行模式自动确定范围
	- <：表示高亮选区首行
	- >：表示高亮选区最后一行

用模式指定范围：
- /字符串1/,/字符串2/：即表示字符串1和字符串2之间的所有行

用偏移对地址进行修正：
- {address}+n：如果 n 被忽略，则偏移为 1，{address} 可以是行号，位置标记或查找模式

# 技巧 29 使用 :t 和 :m 命令复制和移动行
---

:copy 的简写是 :t 或 :co
:move 的简写是 :m

命令行模式中重复上次操作：@:

# 技巧 30 在指定范围上执行普通模式命令
---

它和 Vim 的重复命令结合在一起时，最为强大
- 即 :normal .
- 也可以用 :normal@q 应对复杂的任务

# 技巧 31 重复上次的 Ex 命令
---

即 @: 来重复上次的 Ex 命令

它在遍历缓冲区列表时非常好用
- :bn + @:

# 技巧 32 自动补全 Ex 命令
---

\<C-d> ：可以显示可用的补全列表
- 然后当只有一项时，按 \<Tab> 可以自动补全

# 技巧 33 把当前单词插入到命令行
---

在命令行模式下：\<C-r>\<C-w>会复制光标下的单词，并把它插入到命令行中

# 技巧 34 回溯历史命令
---

在命令行模式中，按下 \<Up> 与 \<Down> 进行历史滚动
- \<C-p> 与 \<C-n>

默认情况下它只记录最后 20 条命令

q:：这个命令可以打开命令行窗口
- :q 命令可以关闭命令行窗口

q/：打开查找命令历史的命令行窗口

\<C-f>：在命令行模式下，切换到命令行窗口

# 技巧 35 运行 Shell 命令
---

在命令行模式中，给命令前加一个 ! 就可以调用外部程序

或者使用 :shell 来启动一个交互的 shell 会话
- 然后用 exit 命令退出此 shell 并返回 Vim
- 相当于把 Vim 置于后台了

:read !{cmd}：将输出插入到当前光标下方
:\[range]write !{cmd}：以 \[range] 作为标准输入
:\[range] !{filter}：使用外部程序 {filter} 过滤指定的 \[range]

