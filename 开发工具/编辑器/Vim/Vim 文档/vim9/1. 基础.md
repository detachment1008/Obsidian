# 更新 vim

```shell
sudo add-apt-repository ppa:jonathonf/vim
sudo apt install vim
```

# 变量

变量是强作用域的，有四种作用域：
```
# 缓冲区
b
# 窗口
w
# 全局
g
# 预定义
v
```

给这些变量赋值时，直接赋值即可：
```
g:counter = 3
```

还有一种脚本的临时变量，必须用 var 表示：
```
var counter = 5;
```

可以删除非脚本的临时变量，用 unlet：
```
unlet g:counter
```

脚本的临时变量可以设为空值或 null：
```
counter = null
```

# 类型

也是强类型的语言，每次通过赋值来推导类型；如果不赋值就需要指明类型了：
```
var name = "peter"
var age: number
```

字符串类型，string：
```
var name1 = "peter"            # 内部可以使用转义字符
var name2 = 'peter'            # 内部除了 ' 都保持原样
var name3 = "peter" .. name2   # 字符串连接
```

字符串匹配：
```
str =~ pat # 匹配
str !~ pat # 不匹配
```

# 表达式

环境变量：
```
$NAME
```

选项：
```
&name
```

寄存器：
```
@r
```

字符串：
```
$"name: {nam}"
```
- 解析内部用 {} 包裹的变量

# 执行字符串命令

使用 execute 关键字：
```
execute "tag " .. tagname
```

执行普通模式命令：
```
normal gg=G
```

execute 和 normal 相结合：
```
execute "normal " .. count .. "j"
```

只希望获取结果，而非执行，使用 eval 关键字：
```
var optname = "path"
var optvalue = eval('&' .. optname)
```

# 函数

定义函数：
```
def Min(num1: number, num2: number): number
    if num1 < num2
	return num1
    else
	return num2
    endif
enddef
```

不需要返回值：
```
def Min(num1: number, num2: number)
enddef
```

返回任何类型：
```
def Min(num1: number, num2: number): any
enddef
```

范围调用函数：
```
:10,15Number()
```
- 表示在 10 - 15 每一行都调用这个函数
- 可以利用 `line('.')` 和 `getline('.')` 等函数针对每行进行处理

可以用变量来持有函数，但必须首字母大写：
```
var fun = Min
```

# 复合类型

有序列表(弱类型数组)：
```
var alist = ['aap', 'noot']
```
- 下标从 0 开始

添加条目(末尾)：
```
add(alist, 'miss')
```

列表首尾相连：
```
alist = alist + ['and', 'more'] # 使用 + 的方式
extend(alist, ['and', 'more'])  # 使用函数的方式
```

可以 for 遍历列表：
```
for n in alist
endfor
```

创建一个纯数字的列表：
```
range(3)        # 第一个是 0, 最后一个是 2; range(大小)
range(8, 4, -2) # range(第一个值，最后一个值，步长) 步长默认是 1
```

字典(哈希表)：
```
var nl = {one: 'een', two: 'twee', 3: 'test'}
```
- `:` 后面必须留一个空白
- 也可以用 `.` 获取：`nl.one`

# 其他

同一行分割两个命令：`|`