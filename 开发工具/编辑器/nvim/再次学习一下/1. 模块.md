[[https://github.com/glepnir/nvim-lua-guide-zh]]

# 加载位置

1. `nvim` 会将所有 `runtimepath` 路径下的 `lua` 命名的目录作为 `lua` 模块；即在任何地方，都可以 `require` 这个里面的 `lua` 文件
2. 如果 `lua` 文件的名字是 `init.lua`；`require` 的时候只需要提供目录名就可以了，名字可以省略

即：
- 如果文件在 `lua` 目录下，可以直接 `require`
- 如果文件在 `lua` 目录下的子目录下，且命名为 `init.lua`；可以用目录名省略 `init` 文件名

# 特殊目录中，自动加载的 `lua` 文件

如果在 `runtimepath` 中的目录中，有这样的一级子目录：
- `colors/`
- `compiler/`
- `ftplugin/`
- `indent/`
- `plugin/`
- `syntax/`

会遍历这些文件夹中的所有 `lua` 文件，并执行(`vim` 的先于 `lua` 文件)

# `luado`

对选中的行，或整个文件的每一行执行，然后被输出的字符串覆盖，如：
```lua
luado return "hello world"
```
- 会使当前缓冲区的每一行都替换为 `hello world` 文本

可以看作是对每一行执行的一个函数，有两个参数：
```lua
line：当前行文本
linenr：它的行号
```

# Vim 命名空间

Neovim 保留了一个全局的 vim 变量来作为 Lua 调用 Vim 的 API 入口

## vim.inspect

打印 table

## vim.regex

正则表达式

## vim.api

vim 相关的 API

### 执行 vimscript 代码块

```lua
local result = vim.api.nvim_exec("...", true) -- 第一个参数表示 vimscript 字符串，第二个参数表示是否需要返回值
local result = vim.api.nvim_exec([[...]], true) -- 可以使用 [[...]] 来使用原始字符串(非转义)
```

```lua
vim.cmd() = vim.api.nvim_exec(..., false)
```
- 是一个固定不要返回值的别名函数

### 执行 Ex 命令

```lua
vim.api.nvim_command("set number")
```

### 管理选项

#### 全局选项

```lua
vim.api.nvim_set_option()
vim.api.nvim_get_option()
```

#### 缓冲区选项

```lua
vim.api.nvim_buf_set_option()
vim.api.nvim_buf_get_option()
```

#### 窗口选项

```lua
vim.api.nvim_win_set_option()
vim.api.nvim_win_get_option()
```

#### 元访问器

```lua
-- 局部
vim.o
-- 全局
vim.go
-- buffer 选项
vim.bo
-- 窗口选项
vim.wo
```

### 管理变量

#### 内部变量

```lua
-- 全局
vim.api.nvim_set_var()
vim.api.nvim_get_var()
vim.api.nvim_del_var()
-- 缓冲区
vim.api.nvim_buf_set_var()
vim.api.nvim_buf_get_var()
vim.api.nvim_buf_del_var()
-- 窗口
vim.api.nvim_win_set_var()
vim.api.nvim_win_get_var()
vim.api.nvim_win_del_var()
-- 选项卡
vim.api.nvim_tabpage_set_var()
vim.api.nvim_tabpage_get_var()
vim.api.nvim_tabpage_del_var()
-- 预定义
vim.api.nvim_set_vvar()
vim.api.nvim_get_vvar()
```

#### 变量的元访问器

```lua
vim.g   -- 全局变量
vim.b   -- 缓冲区变量
vim.w   -- 窗口变量
vim.t   -- 选项卡变量
vim.v   -- 预定义变量
vim.env -- 环境变量
```

### 调用 vimscript 函数

```lua
vim.fn.<函数名>()
```

### 映射

- 全局映射：
    - `vim.api.nvim_set_keymap()`
    - `vim.api.nvim_get_keymap()`
    - `vim.api.nvim_del_keymap()`
- 缓冲区映射：
    - `vim.api.nvim_buf_set_keymap()`
    - `vim.api.nvim_buf_get_keymap()`
    - `vim.api.nvim_buf_del_keymap()`

### 创建用户命令

- 全局用户命令
    - `vim.api.nvim_create_user_command()`
    - `vim.api.nvim_del_user_command()`
- Buffer-local 的用户命令
    - `vim.api.nvim_buf_create_user_command()`
    - `vim.api.nvim_buf_del_user_command()`

### 自动命令

见：`help api-autocmd`

### 语法高亮


- [`:help nvim_set_hl()`](https://neovim.io/doc/user/api.html#nvim_set_hl())
- [`:help nvim_get_hl_by_id()`](https://neovim.io/doc/user/api.html#nvim_get_hl_by_id())
- [`:help nvim_get_hl_by_name()`](https://neovim.io/doc/user/api.html#nvim_get_hl_by_name())

## vim.ui

ui 相关函数

## vim.loop

事件模块

## vim.lsp

内置客户端的 lsp 模块

## vim.treesitter

treesitter 库中的一些函数