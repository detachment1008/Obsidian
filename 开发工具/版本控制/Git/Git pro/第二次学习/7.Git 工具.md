# 引言
---

这些是 Git 强大的功能，可能并不会在日常工作中使用

# 7.1 选择修订的版本
---

Git 可以以多种方式指定单个提交，一组提交，或者一定范围内的提交

## 单个修改版本

通过一个完整的 `SHA-1` 散列值来指定它

## 简短的 SHA-1

要求：
1. 不得少于 4 个
2. 没有歧义

## 分支引用

如果它是一个分支的顶端提交，那么任何需要引用到该提交的 Git 命令中直接使用该分支的名称即可

## 引用日志

当工作时，Git 会在后台保存一个引用日志，记录了近几个月你的 `HEAD` 和分支引用所指向的历史

`git reflog`

每当 HEAD 指向的位置发生了变化，Git 就会将这个信息存储到引用日志这个历史记录里

## 祖先引用

如果引用的尾部加上一个 `^`，就会解析为上一个引用

也可以在 `^` 后面添加数字，来指定哪一个父提交，默认是第一个父提交

`~` 和 `^` 的作用相同

可以组合来指定哪一个父提交

## 提交区间

### 双点

`git log master..experiment`：查看 `experiment` 分支中还有哪些提交没有合并入 `master` 分支；注意区间是左开右闭

常用的操作：`git log origin/master..HEAD`

### 多点

下面三条命令等价
```
git log refA..refB
git log ^refA refB
git log refB --not ref A
```
即 `^` 或 `--not` 可以指明不希望包含在其中的分支

### 三点

`git log master...experiment`：选择被两个引用之一包含，但是又不被两者同时包含的提交

# 7.2 交互式暂存
---

当修改了大量文件后，希望将这些改动拆分为若干提交，而不是混杂在一起成为一个提交时
```
git add -i // 或 git add --interactive
```

## 暂存与取消暂存文件

输入：`u` 或 `2`：暂存
输入：`r` 或 `3`：取消暂存
输入：`d` 或 `6`：查看暂存区和仓库的区别

## 暂存补丁

输入：`p` 或 `5`：可以暂存一部分文件

# 7.3 贮藏与清理
---

当你想切分支，但是不想提交时：`git stash`

## 贮藏功能

贮藏工作目录修改和暂存区：
```
git stash / git stash push
```

查看贮藏的东西：最上面的是栈顶
```
git stash list
```

应用更旧的贮藏：如果不指定就是最近的
```
git stash apply stash@{2}
```

但是应用后，之前暂存的就不再暂存了；如何希望它还是暂存的：其实试验了以下，本来就是暂存了
```
git stash apply --index
```

丢弃贮藏：
```
git stash drop stash@{0}
```

应用并立即丢弃：
```
git stash pop
```

## 贮藏的创意性使用

`git stash --keep-index`：不仅贮藏，还将其保留在索引中

`git stash -u`：也贮藏未跟踪文件

`git stash -a`：包含忽略文件

## 从贮藏创建一个分支

希望在重新应用工作，会冲突；希望以一个轻松的方式再次测试贮藏的改动：
```
git stash branch <branch>
```

## 清理工作目录

`git clean`：移除未被跟踪的文件，这样就无法找回了；可以用 `git stash -a` 来代替


# 7.4 签署工作
---

## GPG 介绍

## 签署标签

## 验证标签

## 签署提交

## 每个人都必须签署

# 7.5 搜索
---

# 7.6 重写历史
---

# 7.7 重置解密
---

# 7.8 高级合并
---

## 合并冲突

首先，在做一次有冲突的合并前，尽可能保证工作目录时干净的，如：
- 提到一个临时分支
- 暂存它

否则容易失去这些修改

### 空白修改的合并

这其实不算是冲突，因为它只是多了一些空白修改，我们可以让 Git 忽略它
- `-Xignore-all-space`：完全忽略空白修改
- `-Xignore-space-change`：将一个空白符与多个连续的空白符视作等价

### 手动文件再合并

首先，我们进行 `merge` 合并，并进入了合并冲突的状态。

此时，我们希望修复任何一边的文件，然后为这个文件单独进行一次合并

此时有三个版本的文件供我们参考：
1. 共同版本的文件：分支叉开时的位置
2. 我们版本的文件
3. 他们版本的文件

方法一：
获取文件的拷贝：`git show <SHA-1> > <new_file_name>`
- 可以使用 `:<序号>:<file_name>` 来代替 `<SHA-1>` 值
- `:<序号>:`：表示第几个父提交的引用

方法二：直接获取它们的 `SHA-1` 值
```
git ls-files -u
```

然后，可以使用 `git merge-file` 重新合并

示例：`git merge-file -p hello.ours.rb hello.common.rb hello.theirs.rb > hello.rb`

`git merge-file`：是一个三向文件合并的命令，即它可以将三个不同版本的文件合并为一个文件(也可以是两个文件)
- `-p` ：将结果输出到屏幕，否则将输出到第一个文件里。

>`git diff -b`：`-b` 选项可以去除空白

# 7.9 Rerere
---

# 7.10 使用 Git 调试
---

# 7.11 子模块
---

# 7.12 打包
---

# 7.13 替换
---

# 7.14 凭证存储
---

# 7.15 总结
---
