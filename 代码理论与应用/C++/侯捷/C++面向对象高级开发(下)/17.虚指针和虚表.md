# 虚指针和虚表

即 vptr和vtbl
- virtual pointer
- virtual table

虚函数非常重要：
- 没有虚函数，继承就没有很大的意义了

特点：
- 只要类中有虚函数，无论有多少个：对象中就会多出一个指针成员(vptr)
	- 只要父类有虚函数，子类一定也有
	- 因为对于函数，子类会继承它的调用权
		- 个人疑问：私有虚函数呢
- 函数也会占据内存，但是我们不关注它的大小
	- 继承时，也不会改变内存，因为只继承调用权
- 虚指针指向一个表(vtbl)
	- 这个表中放的都是函数指针，指向虚函数对应的位置
	- 当继承时，会同时继承父类的虚表，然后再添加自己的虚函数上去
	- 如果自己的虚函数重写了父类的虚函数，就会在虚表上对应的函数指针位置进行替换
- 函数调用
	- 如果是普通函数调用，会通过 call 来进行代码的跳转，这是一种静态的绑定
	- 而虚函数的调用，会通过虚指针，进入虚表，然后根据虚表找到对应函数，这是动态绑定
		- 调用时内部的实现：`(*(p->vptr[n]))(p)`
			- 有个this指针
		- 继承，就好像子类只是改了父类的虚表

静态绑定：在编译时，就能确定它调的是哪个函数
动态绑定：在运行是，才能确定调的是哪个函数
- 必须用指针调用
- 指针需要向上转型
- 需要使用虚函数

这种用法就是多态

