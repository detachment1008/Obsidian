# 模板测试
---

当片段着色器处理完一个片段后，模板测试会开始执行
- 和深度测试一样，它也可能会丢弃片段
- 接下来，保留的片段才会进入深度测试
- 模板测试是根据又一个缓冲来进行的，它叫做模板缓冲

模板缓冲：
- 通常每个模板值都是 8 位的
- 所以每个像素一共能有 256 种不同的模板值
	- $2^8 = 256$

大体步骤：
1. 启用模板缓冲的写入
2. 渲染物体，并更新模板缓冲的内容
3. 禁用模板缓冲的写入
4. 渲染其他物体，根据模板缓冲的内容丢弃特定的片段
	- 我们可以根据场景中已绘制的其他物体的片段，来决定是否丢弃特定的片段

```
//启用模板缓冲
glEnable(GL_STENCIL_TEST)
//清除模板缓冲
glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT | GL_STENCIL_BUFFER_BIT)
//设置模板缓冲(会进行与运算，刚开启时都是1)
glStencilMask(0xFF)
glStencilMask(0x00)
```

# 模板函数
---

一共有两个函数用来配置模板测试：
1. glStencilFunc：如何进行测试
	- 参数1：设置模板测试函数
	- 参数2：设置模板测试的参考值，即模板缓冲的内容会与这个值进行比较
	- 参数3：设置掩码，它将会与参考值和储存的模板值在测试比较它们之前进行与运算
2. glStencilOp：如何更新模板缓冲
	- 参数1：模板测试失败时采取的行为
	- 参数2：模板测试通过，但深度测试失败时采取的行为
	- 参数3：模板测试和深度测试都通过时采取的行为

# 物体轮廓
---

步骤：
1. 在绘制物体轮廓前，将模板函数设置为 GL_ALWAYS，每当物体的片段被渲染时，将模板缓冲更新为 1
2. 渲染物体
3. 禁用模板写入以及深度测试
4. 将每个物体缩放一点点
5. 使用一个不同的片段着色器，输出一个单独的边框颜色
6. 再次绘制物体，但只在它们片段的模板值不等于 1 时才绘制
7. 再次启用模板写入和深度测试