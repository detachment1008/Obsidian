# 隐藏面消除


目前已知如何在屏幕上绘制一个三角形了，即把一个三角形的顶点从三维空间中投影到标准立方体中，如果再进行隐藏面消除，就会有更好的真实性，即近处的面遮挡远处的面
1. BSP树
2. z缓冲器
3. 光线追踪(不符合标准的投影-光栅化过程)

# 8.1 BSP树

它对所有的表面都按照从前到后的顺序进行排序，做法是利用预处理过程建立了一个数据结构，该结构对任何的视点都是使用的。

## 8.1.1 BSP树算法概述

即维护一颗二叉树，左树在面的一边。右树在面的另一边。

## 8.1.2 构造 BSP 树

难点：三角形穿越了分割平面的情况

此时，需要找到交点 A 和 B，然后分成三个三角形。注意顶点顺序，因为需要保证法线和原来的三角形是相同的

需要考虑一些特殊情况：
- 顶点距离分割平面非常近：此时会因数据精度带来巨大的问题

## 8.1.3 分割三角形

可以通过交换顶点，把分割三角形看作是一种情况，然后统一处理

## 8.1.4 优化 BSP 树

因为构造BSP树是在预处理过程中，所以无需担心效率问题，只需要考虑遍历BSP树即可。

遍历树的时间与树的结点个数成正比(和树的平衡性无关)

# 8.2 z 缓冲器

真正的问题是找出距离每一个像素中心最接近的多边形

## 8.2.1 z 缓冲器算法

在每一个像素处，存储一个 z 值，即当前像素中心到已经光栅化的三角形的最近距离。仅当 z 值到观察者更近时，才将 rgb 值和 z 值写入光栅中

## 8.2.2 整数 z 缓冲器

实践中存储在 z 中的是非负整数，因为快速内存比较贵，所以不用浮点数

因为有精度问题，所以 n 和 f 的选择非常重要