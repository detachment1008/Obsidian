# 表面明暗处理

为了使得物体更有立体感，我们可以使用明暗处理

# 9.1 漫反射明暗处理

世界上有很多物体表面是粗糙的，即视点发生改变时颜色不会发生改变。这种物体被称为朗伯物体

注意：本章的所有公式都是在世界坐标系中进行的，否则经过投影法线会变化

## 9.1.1 朗伯明暗处理模型

一个特性特性：朗伯物体都满足
- 朗伯余弦定理：物体表面颜色c与表面法线和光线入射方向的夹角的余弦成正比
	- c：物体表面颜色
$$c \varpropto cos\theta$$ $$ c \varpropto n · l$$
如果我们加上漫反射系数(即物体表面颜色)
- $c_r$：物体表面 RGB 颜色
$$c\varpropto c_rn·l$$

如果我们再加上光线强度
- $c_l$：光线强度
$$c=c_rc_ln·l$$

点积可能是负的，即表面在光线的背光处
- 单面光照：即远离光线方向时，不显示
$$c=c_rc_lmax(0,n·l)$$
- 双面光照：即假设两面有相同的光照
$$c=c_rc_l|n·l|$$

## 9.1.2 环境明暗处理

在上述处理中，所有没有被光照射到的地方都是黑的(背光面)，而实际生活中，因为间接光照的原因，所以还是亮的。

一些处理方式：
- 眼睛处放置一个较暗的光源
- 上述的双面光照
- 添加一个环境项，来模拟间接光照
	- $c_a$：表示间接光照的亮度
$$c=c_rc_a+c_rc_lmax(0,n·l))$$

注意：如果 RGB 值大于 1，程序应该把该值置为1

## 9.1.3 基于顶点的漫反射明暗处理

我们可以把法线放在顶点上，然后在三角形内部使用重心插值获取法线，然后使用上述的漫反射处理模型进行处理

如何计算顶点的法线？
- 计算一个顶点的所有三角形的法线，然后取平均值即可

# 9.2 Phong明暗处理

某些物体表面上是不光滑的，但是还具有光滑物体的效果：高光
- 高光的颜色与物体无关，它是光线的颜色
- 会随着视点的移动而移动

## 9.2.1 Phong 光照模型

高光和视点有关：当视点和反射光重合时，高光最亮
- $c$：高光颜色
- $c_l$：光线颜色
- $e$：视点方向
- $r$：反射光线方向
$$c=c_l(e·r)$$

但是这个效果的范围不真实，太大了。所以我们要进行优化：
- $p$：Phong指数，是一个正实数。
$$c=c_lmax(0,e·r)^p$$

但是 $e·r$ 不好计算，可以使用 Blnn-Phong进行计算优化：
- $h$：视点和入射光线的角平分线向量
- $n$：法线
	$$c=c_l(h·n)^p$$

再优化，我们允许用户改变高光颜色或减弱高光：增加一项$c_p$
- $c_p$：是一个控制项，用户可以用它来改变高光的颜色或控制高光的亮度
$$c=c_lc_p(h·n)^p$$

当然，大部分物体都是有漫反射的，所以我们合并起来后：
$$c = c_rc_a + c_rc_lmax(0,n·l) + c_lc_p(h·n)^p$$

注意：亮度和颜色可以是一个东西，因为它们的范围是\[0,1]，即可以认为它是颜色，也可以认为它是亮度(乘上颜色)

## 9.2.2 表面法线向量插值

我们需要对每个像素都进行插值得到法线，否则就会生成伪像

# 9.3 艺术化明暗处理

朗伯明暗处理和Phong明暗处理都是模拟真实世界中的外观，而艺术化的明暗处理是用来模拟人类艺术家的绘画的。

生成这样的图像被称为：非真实感绘制

## 9.3.1 线图

即轮廓线，在艺术家绘图中很常见，但是在现实世界中是没有的。

对一条边来说：当一个三角形朝向观察者，另一个三角形背向观察者，那么应该把这条边作为轮廓线画出来：
- $e$：视点方向
- $n_0$：法线向量
- $n_1$：另一个法线向量
$$(e·n_0)(e·n_1) <= 0$$

或者用三角形的隐式方程表示：
$$f_0(e)f_1(e)<=0$$

画出所有的折痕，即几何模型中的棱角：
$$n_0·n_1<=某一阙值$$

## 9.3.2 冷暖明暗处理

