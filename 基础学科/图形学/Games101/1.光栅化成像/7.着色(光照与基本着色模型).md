# 着色

其实就是决定了一个像素真正应该显示的颜色

它由两部分组成：
1. 原本颜色
2. 亮度

我们之前都只考虑它原本的颜色，但是它不是像素真正的颜色。现在我们要加上亮度，让它更加真实

其实入射的光线才是总能量，然后物体表面的颜色表明的是它不吸收的能量的比例，相乘就是出射光的能量。(我们都以 \[0,1] 的范围描述能量)

# Blinn-Phong 反射模型

我们都是在世界坐标系中进行描述的，之前的光栅化部分都是要变换为屏幕坐标系，再开始操作的

还是在变换为屏幕坐标系后再开始操作的：
1. 将世界坐标系中的光源位置，视点位置等信息记录并传递，然后通过顶点法向量插值得到当前点法向量

组成布林峰光照模型的三个部分：
1. 高光
2. 漫反射
3. 环境光

一些输入信息：
1. 法线
2. 光照方向
3. 视点方向
4. 表面颜色

着色都只考虑局部，即不考虑其他物体存在造成的影响
- 即无法生成阴影

## 高光

当物体表面较光滑，反射方向接近镜面反射的方向时的一种现象

即当观察方向和反射方向相同或接近时，可以看到高光

### Blinn 的优化

我们在判断观察方向和反射方向的接近程度时，可以去考虑入射方向和观察方向的角平分线方向和法线的接近程度，这两者是等价的，但是后者更好计算。
- 两个向量相加，就是角平分线向量

我们在此处认为入射光能量完全交给物体，即不考虑入射角度造成的能量发散问题。

公式：
- $\frac{I}{r^2}$：入射光能量
- $k_s$：物体不吸收的能量比例，即反射出去的能量比例
- $\alpha$：观察方向和镜面反射方向的夹角
- $h$：观察方向和入射方向的角平分线向量
- $p$：控制高光显示的范围，单用 $cos\alpha$ 的话太平滑了，我们希望范围很小才能看到(一般用 100~200 之间的数字)
$$L_s=\frac{I}{r^2}k_smax(0,cos\alpha)^p$$
$$L_s=\frac{I}{r^2}k_smax(0,n·h)^p$$


## 漫反射

即当入射光照射上去之后，以均匀的能量向四周发射出射光

重点：入射光的能量是多少呢

1. 入射光随距离，能量会衰减

我们认为光是球壳向外发射能量的，则当传播距离 $r$ 时，球壳的面积为 $4\pi r^2$，而初始时，我们设距离是 1 时球壳的亮度为 $I_0$，则它的能量被衰减为了 $$I_1=\frac{I_0}{r^2}$$
2. 入射光能量未必会全部交给物体，当它和法线有角度时，会发散出去一部分，从而只交给物体部分能量

它和射向物体的角度有关，即当垂直时全部吸收，平行时无法吸收，即：$$I_2=I_1*cos\theta$$
$$cos\theta=n·l$$

- $n$：法线方向
- $l$：入射光方向

即：$$I_2=I_1*n·l$$
结合起来，就是漫反射项：
$$L_d=(\frac{I}{r^2})max(0,n·l)k_d$$

- $\frac{I}{r^2}$：入射光经过距离衰减，抵达时的能量
- $max(0,n·l)$：入射光经过角度反射后，被物体吸收的能量
- $k_d$：物体本身不吸收的能量比例
- $L_d$：即经过漫反射后，反射光线的能量

## 环境光

即模拟了间接光照，我们认为任何一个点接收到的环境光都是相同的

公式：
- $I_a$：环境光的能量，它是一个常量
- $k_a$：物体对环境光不吸收的程度，即反射的程度
$$L_a=I_ak_a$$