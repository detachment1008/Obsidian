# 变换

关于正交矩阵：
- 它的列向量之间互相垂直
- 它的逆就等于它的转置

# 齐次坐标之平移

当我们表示平移时，无法直接用矩阵表示，因为它不是一个线性变换。

如果要用矩阵变换，只能进行升维：
1. 向量的升维
	- 3D point = $(x,y,z,1)^T$
	- 3D vector = $(x,y,z,0)^T$
2. 矩阵的升维：
	- $X,Y,Z$：分别表示 $x,y,z$ 方向上的平移量
	$$\begin{bmatrix}
	*&*&*&X\\
	*&*&*&Y\\
	*&*&*&Z\\
	0&0&0&1\\
	\end{bmatrix}$$

# 三维空间中的绕轴旋转

1. 绕着 $x$ 轴旋转
$$\begin{bmatrix}
1&0&0&0\\
0&cos\theta&-sin\theta&0\\
0&sin\theta&cos\theta&0\\
0&0&0&1\\
\end{bmatrix}$$
3. 绕着 $y$ 轴旋转
$$\begin{bmatrix}
cos\theta&0&sin\theta&0\\
0&1&0&0\\
-sin\theta&0&cos\theta&0\\
0&0&0&1\\
\end{bmatrix}$$
5. 绕着 $z$ 轴旋转
$$\begin{bmatrix}
cos\theta&-sin\theta&0&0\\
sin\theta&cos\theta&0&0\\
0&0&1&0\\
0&0&0&1\\
\end{bmatrix}$$

注意：因为旋转的方向不同，所以 $y$ 轴旋转和其他的符号也有所差别(它是逆向)

举例：当 $x$ 轴向 $y$ 轴旋转时，我们通过右手法则定下的才是旋转轴，如果它和 $z$ 轴相符合，那么它就是绕 $z$ 轴旋转，如果它和 $z$ 轴相反，我们可以把旋转转置，这样就是绕 $z$ 轴旋转了

# 三维空间中的任意旋转

解决方式一：分解

我们可以把任何的旋转分解为绕 $x,y,z$ 轴的旋转，旋转的角度分别为 $\alpha,\beta,\gamma$ 。他们被称之为欧拉角

解决方式二：[[7.观察#^5183e5|罗德里格斯旋转公式]]

这里默认给出的旋转轴是过原点的

但是当我们希望绕任意轴旋转怎么办？
- 将其平移到原点
- 做旋转
- 再将其平移回去

四元数：主要是用作插值的
- 旋转矩阵不适合做插值
- 可以看看旋转和四元数转化这个方面的东西

# 模型变换(Local to World)

# 视图变换(World to View)

一些视点的初始定义：
- 位置
- 朝向
- 头顶方向

当物体和视点同时发生相同的移动时，我们看到的画面一定是不变的，所以为了统一，我们规定视点：
- 位置：原点
- 朝向：$-z$
- 头顶：$+y$

如果我们定义原始的视点的位置为 $e$，朝向为 $g$，头顶为 $t$，则：
1. 将 $e$ 平移到原点
2. 将 $g$ 旋转到 $-z$
3. 将 $t$ 旋转到 $+y$

$$M_{view}=R_{view}T_{view}$$

此时，旋转矩阵 $R_{view}$ 并不好求，但是逆旋转比较好求，如：$(0,1,0,0)^T$ 向量旋转到给定的向量 $t$ 上。

所以，我们可以先算出它的逆旋转，然后求逆就自然而然的得到了它的旋转矩阵(注意：我们用 $g$ x $t$ 来表示 $x$ 轴)。此时，它是正交矩阵，转置就等于逆矩阵。

此时，我们已经求出来了相机移动到标准位置的矩阵，为了保证相对位置不变，场景上的所有其他物体都要进行这样的变换矩阵。

# 投影变换(View to Clip)

## 正交投影(非近大远小)

	一种简单的做法：
	1. 按标准位置和方向摆放好摄像机
	2. 扔掉 z 值，即此时所有物体都会被投影到近平面上去
	3. 通过旋转和缩放，将这个近平面变成 [-1,1]^2 大小的正方形

正规的做法：
1. 定义空间中的长方体，通过六个数来描述它 $l$$,$r$,$$b$,$t$,$n$,$f$
2. 通过平移+缩放的方式，将这个长方体变换为一个 $[-1,1]^3$ 这样一个立方体

注意：$l$<$r$，$b$<$t$，但是 $f$<$n$，因为我们是朝向 $-z$ 方向看的

## 透视投影(近大远小)

它和正交投影明显的区别，就是它的远平面比近平面大

	一种简单的做法：
	1. 将这个四棱锥向里挤压，从而形成一个长方体
		1. 近平面保持不变
		2. 远平面的 z 值保持不变
		3. 远平面是向中心挤压的，即它的中心点也保持不变
	2. 然后再用上述的正交投影，将里面的所有物体投影到近平面上即可

困难点：如何完成挤压操作？

通过相似三角形，我们发现：$x$，$y$ 有如下的变换
- $x'=\frac{n}{z}x$
- $y'=\frac{n}{z}y$

此时，我们已经能得到投影变换矩阵的 1，2，4 行了，因为他们是缩放的关系(利用齐次坐标，将矩阵中的 $z$ 值给消掉)

然后，再利用前面近平面和远平面的条件，就可以得到第三行了

此时，我们就得到了挤压这一步操作是矩阵了，通过它就可以变换为长方体的可视区域了，然后再通过正交投影，即可映射为标准立方体了
