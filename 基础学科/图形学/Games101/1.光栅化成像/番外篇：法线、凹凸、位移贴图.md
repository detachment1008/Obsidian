# 凹凸贴图

1 维黑白的图片，即一个元素只占 8 位，则图片越白，表示的高度越高

它是用来伪装高模的，因为游戏需要实时，所以一般用低模+凹凸贴图来模拟高模的模型。它没有改变物体的形状，所以边缘的地方可能会露馅。

由凹凸贴图求法线的方法：高度场

## 梯度

梯度即偏导数，表示某一函数在该点处沿什么方向变化最快，变化率最大

以 3 个自变量的函数举例，梯度就是 (x 偏导, y 偏导, z 偏导)

## 求解公式

$$normal=\frac{[H_g-H_r,H_g-H_a,1]}{(H_g-H_a)^2+(H_g-H_r)^2+1}$$
- $H_g$：当前凹凸贴图记录的高度
- $H_a$：当前凹凸贴图上方记录的高度
- $H_r$：当前凹凸贴图右方记录的高度

# 法线贴图

一般由凹凸贴图算出，因为如果直接存储，一个元素需要占 24 位的空间。

## 法线转换为法线贴图

将法线通过 RGB 格式存储为法线贴图：通过压缩范围

因为归一化的法线的每个分量的范围是\[-1,1]，而 RGB 的格式为 \[0,1]，所以需要范围压缩

转换到法线贴图：$0.5*normal + 0.5$
转换回法线向量：$(col-0.5)*2$

# TBN 矩阵

我们在根据梯度计算法向量时，都是默认原先的法向量是 $(0,0,1)$，但实际上大部分情况下并不是，所以可以说我们都是在局部空间下计算的法向量

所以在计算完法向量之后，需要将这个法向量从局部空间转换到世界空间中去，这个转换矩阵就是 TBN 矩阵

TBN 矩阵：Tangent 切线，Bitangent副切线，Normal 法线组成的 3\*3 矩阵(切线和副切线是正交后的，且三个向量都是世界空间下的向量)

TBN 是正交矩阵，即它的逆就等于它的转置


