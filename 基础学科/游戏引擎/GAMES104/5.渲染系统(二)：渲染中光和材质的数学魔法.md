# 5.1 渲染方程及挑战
---

## 5.1.1 渲染方程

它描述了所有全局光照的理论基础：
$$L_0(x, \omega_0) = L_e(x, \omega_0) + \int_{H^2}f_r(x,\omega_0, \omega_i)L_i(x,\omega_i)cos\theta_id\omega_i$$
- $x$：该点的位置
- $w_0$：该点到观察点的方向向量
- $w_i$：入射光的方向向量，$x$ 作为起点
- $L_0(x,\omega_0)$：该点到观察点的辐射度
- $L_e(x,w_0)$：该点的自发光的辐射度
- $H^2$：该空间中的所有方向
- $f_r(x,w_0,w_i)$：该点的入射光的反射率
- $L_i(x,w_i)$：该点的入射光的辐射量
- $\theta_i$：入射光方向向量和该点法向量的夹角

## 5.1.2 解这个渲染方程的挑战

1. 如何判断该点对于某光源是否可见
2. 光源的复杂性
3. 如何高效的求解这个积分(卷积)
4. 任何点都可以被当作光源

# 5.2 局部光照的解决方案
---

## 5.2.1 光照模型

这种简易的方式已经被图形学 API 所支持了

### 5.2.1.1 光源

- 用一个简单的光源作为主光
	- 方向光
	- 点光
	- 锥光
-  用环境光去模拟其他的光
	- 用一个常量，去模拟其他所有的光

### 5.2.1.2 Blinn-Phong 模型

它是经验模型，虽然很简单但是有一些问题的：
- 问题1：它不是能量守恒的
- 问题2：它不能很好的表示细节

## 5.2.2 材质

### 5.2.2.1 环境贴图

目的：反射环境

环境光一般都是白光，只能反应出这一点的颜色，无法映射出其他点(环境)的颜色

>入射光的方向，反射光方向，以及法线重合的情况

我们通过环境贴图，来给某些反射效果很好的物体添加反射附近环境的效果

在某点的法线方向，找到对应的环境贴图位置，用它作为光源进行光照计算即可

### 5.2.2.2 阴影贴图

目的：添加阴影

即从光源为观察点，生成一张深度图

当我们观察一个点的时候，判断这一点在光源的深度图上是否可见，如果不可见就是阴影

问题：
1. 阴影贴图的采样率，和我们的采样率不一定相同

## 5.2.5 总结

- Simple light + Ambient
- Binn-Phong material
- Shadow map

# 5.3 基于预计算的全局光照
----

## 5.3.1 什么是全局光照

全局光照和局部光照(Blinn-Phong)的区别：
- 全局光照：在间接光照方面考虑了各个物体之间的相互作用
- 局部光照：在间接光照方面没有考虑各个物体之间的相互作用，如：用一个常量来代替间接光照

## 5.3.2 如何去表示间接光照

通过预计算的办法，提前去计算全局光照

前提：
- 只能处理不变的光源
- 只能处理静态物体(当更换位置就需要重新计算全局光照)

- 好的压缩率
	- 因为数据量非常的庞大
- 容易和材质进行积分运算

### 5.3.2.1 光照贴图

### 5.3.2.2 光照探针

在空间中生成大量的采样点，根据物体位置，使得附近的采样点进行插值得到物体的颜色

### 5.3.2.3 反射探针

# 5.4 基于物理的材质

## 5.4.1 微平面理论

Microfacet Theory：它认为实际的表面是由许多微小的平面构成的，反射和散射现象都是在这些微平面上发生的

如：
1. 一个表面的微平面法向量都是同一个方向，反射效果就很好，就是镜子了
2. 一个表面的微平面法向量非常离散，那么它的表面就很粗糙了

## 5.4.2 基于微平面的BRDF模型

## 5.4.3 PBR Specular Glossiness

## 5.4.4 PBR MR

# 5.5 基于图像的光照
---

# 5.6 经典阴影方法
---

# 5.7 Shader 的管理
---


