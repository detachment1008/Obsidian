# 9.1 动画技术简介
---

理论基础：视觉残留，即每一幅画面会在人眼中停留大概 $\frac{1}{24}$ 秒

游戏行业的动画理论和工具都来自于电影行业(如：动画电影)

电影中的动画技术发展：
1. 一帧一帧手绘
2. 通过动作演员，动态捕捉

游戏中的动画技术：
1. 捕捉人类行为动画
2. 2d 动画模拟 3d

## 9.1.1 游戏动画中的挑战

挑战：
1. 游戏动画有很强的交互性
2. 游戏动画需要实时($\frac{1}{30}$秒内完成)
3. 游戏动画需要非常真实，包括表情

# 9.2 2D 游戏动画技术
---

## 9.2.1 精灵动画技术

1. 2D应用：我们设计了一系列 Sprite 图片，然后逐帧去播放它
2. 3D 应用：为一个角色录制一系列不同位置的 2D 动画，然后在游戏中根据当前观察的位置播放对应的 2D 动画，以达到一种 3D 的效果
3. 现代游戏中的应用：
	- 2D 背景
	- 3D 环境
	- 特效系统

## 9.2.2 Live2D

它是一个不需要 3D 模型，就可以生成 2D 动画的技术
- 将一个精灵上的各个部分都分离出来，然后组合
- 生成动画的过程，即精灵上这些部分平移和变换的结果

做法：
1. 分离源图像
2. 设置为各种深度
3. 在分离的图像上设置控制点，然后变形图像即可

# 9.3 3D 游戏动画技术
---

DoF：Degrees of Freedom，即自由度
- 3D 空间中有 6 个自由度：平移的 x,y,z ，旋转的 x,y,z

## 9.3.1 刚体层级动画

RHA：(Rigid Hierarchical Animation)，也叫三维骨骼动画

它通过对三维模型建立由多个刚性连接的骨骼系统来实现，每个骨骼与其父骨骼通过关节连接，形成了一个层级结构。

每个骨骼都可以看作是一个刚体，它们之间可以旋转和平移，关节允许不同骨骼之间做相对运动。

它是物理模拟的动画技术，它通过刚体的父子关系，基于刚体来进行动画，并不是骨骼动画

## 9.3.2 逐顶点动画

Per-vertex Animation：它通过操纵网格中每个顶点的位置和法线来实现动画效果

通常使用两个网格，一个作为起始网格，另一个作为结束网格，并将其之间的各个对应的顶点匹配起来

在播放动画的时候，利用插值即可形成平滑的效果

## 9.3.3 变形目标动画

Morph Target Animation：变形目标动画，它通过操纵网格中每个顶点的位置来实现动画效果

它也是一种顶点动画，但是它增加了权重

## 9.3.4 3D 蒙皮动画

3D Skinned Animation：

## 9.3.5 2D 蒙皮动画

和 3D 是通用的

## 9.3.6 基于物理的动画

1. 布娃娃
2. 布料和流体模拟
3. 反向动力学

# 9.4 如何去创造动画
---

## 9.4.1 K 动画

即在编辑器中由动画师 K 动画

## 9.4.2 动作捕捉

# 9.5 蒙皮动画的实现
---

步骤：

每个骨骼都有一个初始状态：绑定姿态(binding pos)

1. 为绑定姿态创建 mesh 网格
2. 为绑定姿态创建骨骼
3. 刷上蒙皮
	- 对每个顶点，都受哪些骨骼的影响
	- 对每个顶点，哪些骨骼影响大，哪些骨骼影响小
4. 制作动画，使骨骼动起来(当然蒙皮也跟着动了起来) 

## 9.5.1 不同的空间

- 世界坐标系
- 模型坐标系
- 局部坐标系

## 9.5.2 构建骨骼

- 人：很像真实的人体骨骼
	- 中心点：在尾椎骨的地方
- 四足动物：
	- 中心点：也是在尾椎骨的地方，即靠后屁股的地方

- 骨骼：实际我们并不存储骨骼，我们存储的是关节
	- 两个关节：组成了一个骨骼

我们一般都会定义一个 root 骨骼，尽管中心点是尾椎骨的地方，如：人的 root 骨骼在两脚中间。放置人在蹲下时，离地高度会改变。四足动物的 root 就在肚子下面

绑定动画时的骨骼，如：两个物体连接在一起，人骑马类型

此时，需要一个 BindJoint 进行连接，它不仅仅是位置上的关联，旋转上也需关联

## 9.5.3 刷上蒙皮

用人物的什么姿势来刷上蒙皮呢？
1. 之前，是用 T 姿势，但是这个姿势会造成肩膀的挤压变形
2. 目前，使用 A 姿势，它比较自然

## 9.5.4 制作动画

关节的 Dof 有 9 个自由度，它不仅有平移和旋转，还有缩放

# 9.6 3D 旋转的数学原理
---

## 9.6.1 2D 旋转

旋转矩阵即可解决，因为它的旋转都是绕着原点进行的

## 9.6.2 3D旋转

相较于 2D 困难很多，因为它可以绕着任意一个轴进行旋转(不仅局限于 x
,y,z 轴)

绕任意一个轴：用绕 x，y，z 轴的旋转模拟出来

可以把这三个矩阵乘起来合成一个旋转矩阵，这就是典型的欧拉角
- 它依赖旋转顺序，即必须有的先旋转，有的后旋转

万向节问题：
- 会出现两个轴重合的现象，即万向节死锁
- 很难插值
- 很难进行旋转叠加
- 很难做定轴运算

## 9.6.3 四元数

首先需要理解复数：
1. 它很容易进行旋转的叠加
2. 两个复数的乘积，可以表示为它们之间的旋转和缩放(因为 $i^2 = -1$ )

四元数：就是从二维空间的 a + bi 扩充到了三维空间中的 a + bi + cj + dk
- $i^2 = j^2 = k^2 = ijk = -1$

然后用四元数去表示欧拉角旋转
