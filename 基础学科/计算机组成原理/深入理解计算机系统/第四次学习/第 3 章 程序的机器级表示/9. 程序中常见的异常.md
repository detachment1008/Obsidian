# 缓冲区溢出

因为程序不会对访问的区域进行检查，所以对于数组(缓冲区)而言很容易就溢出了

栈帧：从高到低
1. 被调用者保存寄存器(`%rbx, %rbp, %r12~15`)
2. 局部变量
3. 调用的函数参数
4. 返回地址

当在局部变量处溢出时，可能将被调用者保存寄存器覆盖，甚至将上一个栈帧的返回地址覆盖了

>蠕虫：自己可以运行 病毒：植入到其他程序中，自身不可以运行

## 对抗缓冲区溢出

### 栈随机化

即栈帧大小随机

地址空间布局随机化中的一种

攻击者可以通过蛮力克服随机化：猜这个大小随机的数值

### 栈破坏检测

在局部缓冲区和状态间插入一个哨兵值，每次检测它来判断是否栈被破坏了

这是 GCC 默认的操作(局部有 `char` 类型的缓冲区时)，如果禁止它产生这个值：`-fno-stack-protector`

### 限制可执行代码区域

三种内存访问形式：
1. 读
2. 写
3. 执行