> Virtual Memory(VM)：虚拟内存，是一种对内存的抽象

能力：
1. 将主存看作是存储在磁盘空间中地址空间的高速缓存
2. 为每个进程提供了一致的地址空间
3. 保护进程的地址空间不被其他进程破坏

# 一些概念

Physical Address(PA)：物理地址
Virtual Address(VA)：虚拟地址
Virtual Page(VP)：虚拟页
Physical Page(PP)：物理页
Page Table Entry(PTE)：页表条目
Page Table Entry Address(PTEA)：页表条目地址
Page Table Base Register(PTBR)：页表基址寄存器
Virtual Page Offset(VPO)：虚拟页面偏移
Virtual Page Number(VPN)：虚拟页号
Physical Page Offset(PPO)：物理页面偏移
Physical Page Number(PPN)：物理页号

全相联，且只写回，不直写

每次访问内存时，都通过页表查看一下：
- 命中：说明页已经在物理内存中了，地址就是真实的物理地址
- 缺页：
	- 找一个页写回
	- 把缺页放入物理内存
	- 更新这两个页的页表条目
	- 重新执行缺页的指令

可以在每个页表项中加入额外的信息，以保证内存的安全(不运行访问内核和修改只读)

# 地址翻译

## 命中

先提取虚拟页地址(前几位)，然后获取物理页地址，然后再加上偏移，访问真实地址

完全由硬件来处理

## 不命中

即发生了缺页，此时由硬件和操作系统共同完成

前几步相同，获取物理地址时，发现有效位是 0，硬件触发一次缺页异常，调用了操作系统的缺页异常处理程序；缺页异常处理程序找到一个牺牲页换出(还要判断它是否被修改)，然后将新页面换入，并更新 PTE，让硬件重新获取物理地址，最后重新执行导致缺页的指令

## TLB 加速地址翻译

Translation Lookaside Buffer(TLB)：翻译后备缓冲器，在 MMU 中包裹

如果 TLB 命中，就不用从缓存中先取出 PTE 这步操作了

## 多级页表

减少了内存需求：
1. 如果一级页表的 PTE 为空，就不用再去查找二级页表了
2. 只有一级页表需要总是在内存中，二级页表项可以需要时再创建或调入